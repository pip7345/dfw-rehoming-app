<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title><%= pack.name %> - DFW Dog Rehoming</title>
  <link href="/tailwind.css" rel="stylesheet" />
</head>
<body class="bg-bg-primary text-text-primary">
  <%- include('partials/nav-bar', { user }) %>

  <div class="max-w-6xl mx-auto p-6">
    <a href="/" class="text-accent hover:underline inline-flex items-center gap-2 mb-4">‚Üê Back to Home</a>

    <div class="card mb-6">
      <h1 class="text-3xl font-bold text-text-primary m-0"><%= pack.name %></h1>
      <% if (pack.description) { %>
        <p class="text-text-secondary text-lg mt-2"><%= pack.description %></p>
      <% } %>
      <div class="bg-bg-tertiary p-4 rounded-lg mt-4">
        <h3 class="font-semibold text-text-primary mb-3">Contact Lister</h3>
        <% if (typeof contactPrefs !== 'undefined' && contactPrefs && contactPrefs.show_email && (contactPrefs.email || lister.email)) { %>
          <div class="flex items-center gap-2 text-text-secondary mb-1">üìß <a class="text-accent hover:underline" href="mailto:<%= contactPrefs.email || lister.email %>"><%= contactPrefs.email || lister.email %></a></div>
        <% } %>
        <% if (typeof contactPrefs !== 'undefined' && contactPrefs && contactPrefs.show_phone && contactPrefs.phone) { %>
          <div class="flex items-center gap-2 text-text-secondary mb-1">üìû <a class="text-accent hover:underline" href="tel:<%= contactPrefs.phone %>"><%= contactPrefs.phone %></a></div>
        <% } %>
        <% if (typeof contactPrefs !== 'undefined' && contactPrefs && contactPrefs.show_messenger && contactPrefs.messenger_username) { %>
          <div class="flex items-center gap-2 text-text-secondary mb-1">üí¨ <a class="text-accent hover:underline" href="https://m.me/<%= contactPrefs.messenger_username %>" target="_blank">Message on Facebook</a></div>
        <% } %>
      </div>
    </div>

    <% if (pack.pets && pack.pets.length > 0) { %>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <% pack.pets.forEach(pet => { %>
          <div class="bg-bg-secondary border border-border rounded-xl overflow-hidden">
            <% if (pet.cloudinary_public_ids && pet.cloudinary_public_ids.length > 0) { %>
              <img src="https://res.cloudinary.com/<%= cloudinaryCloud %>/image/upload/c_fill,w_800,h_600,g_auto/<%= pet.cloudinary_public_ids[0] %>.jpg" alt="<%= pet.name || 'Pet' %>" class="w-full aspect-[4/3] object-cover bg-bg-tertiary" />
            <% } else { %>
              <div class="w-full aspect-[4/3] bg-bg-tertiary"></div>
            <% } %>
            <div class="p-6">
              <div class="flex items-center justify-between gap-2 mb-2">
                <h2 class="text-xl font-semibold text-text-primary m-0"><%= pet.name || 'Unnamed Pet' %></h2>
                <span class="text-xl font-bold text-success">$<%= pet.rehoming_fee != null ? Number(pet.rehoming_fee).toFixed(0) : '50' %></span>
              </div>
              <div class="flex gap-3 flex-wrap mb-4">
                <% if (pet.breed) { %><span class="bg-bg-tertiary px-3 py-1 rounded-md text-sm text-text-secondary"><%= pet.breed %></span><% } %>
                <% if (pet.age) { %><span class="bg-bg-tertiary px-3 py-1 rounded-md text-sm text-text-secondary"><%= pet.age %></span><% } %>
                <% if (pet.size) { %><span class="bg-bg-tertiary px-3 py-1 rounded-md text-sm text-text-secondary"><%= pet.size %></span><% } %>
              </div>
              <% if (pet.description) { %>
                <p class="text-text-secondary leading-relaxed"><%= pet.description %></p>
              <% } %>
              <% if (pet.status) { %>
                <span class="pet-status status-<%= String(pet.status).toLowerCase() %>"><%= pet.status %></span>
              <% } %>
            </div>
          </div>
        <% }); %>
      </div>
    <% } else { %>
      <p class="text-text-secondary">No pets listed in this pack yet.</p>
    <% } %>
  <%- include('partials/pet-details-modal') %>

  <script>
    const CLOUDINARY_CLOUD = '<%= cloudinaryCloud || "" %>';
    function openImage(id) {
      const url = `https://res.cloudinary.com/${CLOUDINARY_CLOUD}/image/upload/${id}.jpg`;
      window.open(url, '_blank');
    }
  </script>
</body>
</html>
