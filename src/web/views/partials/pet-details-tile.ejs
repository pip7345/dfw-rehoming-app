<%
  // Pet Details Tile - Expanded view with all information
  // Props: pet, cloudinaryCloud, isLister (boolean), showEditButton (boolean, default false)
  const showEdit = typeof showEditButton !== 'undefined' ? showEditButton : false;
  const isSold = pet.status === 'adopted' || pet.status === 'sold';
  const isReserved = pet.status === 'pending' || pet.status === 'reserved';
  
  // Get emoji based on animal type
  const getTypeEmoji = (type) => {
    const emojis = { dog: 'üêï', cat: 'üê±', other: 'üêæ' };
    return emojis[type] || 'üêæ';
  };
  const typeEmoji = getTypeEmoji(pet.animal_type);
  
  // Format dates
  const formatDate = (dateStr) => {
    if (!dateStr) return 'Not set';
    const date = new Date(dateStr);
    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
  };
%>

<div class="min-w-[280px] max-w-[588px] bg-bg-secondary border border-border rounded-xl overflow-hidden flex flex-col">
  <!-- Photo Container (same as pet-tile) -->
  <div class="relative w-full h-[441px] bg-bg-tertiary overflow-hidden">
    <% if (pet.cloudinary_public_ids && pet.cloudinary_public_ids.length > 0) { %>
      <img 
        src="https://res.cloudinary.com/<%= cloudinaryCloud %>/image/upload/c_pad,b_rgb:<%= cloudinaryPadRgb %>,w_588,h_441/<%= pet.cloudinary_public_ids[0] %>.jpg"
        alt="<%= pet.name || 'Pet' %>"
        loading="lazy"
        class="w-full h-full object-cover"
      />
    <% } else { %>
      <div class="w-full h-full flex items-center justify-center text-[5rem] text-text-muted"><%= typeEmoji %></div>
    <% } %>
    
    <!-- Status Badge (centered, larger) -->
    <% if (isSold) { %>
      <div class="absolute inset-0 flex items-center justify-center">
        <span class="rounded-md font-semibold bg-danger/90 text-white text-2xl md:text-3xl" style="padding:15px;">Adopted</span>
      </div>
    <% } else if (isReserved) { %>
      <div class="absolute inset-0 flex items-center justify-center">
        <span class="rounded-md font-semibold bg-warning/90 text-white text-2xl md:text-3xl" style="padding:15px;">Pending</span>
      </div>
    <% } %>
  </div>
  
  <!-- Details Container (expandable) -->
  <div class="p-5 flex flex-col gap-3 max-h-[400px] overflow-y-auto">
    <div class="flex justify-between items-center gap-2">
      <h3 class="text-xl font-semibold text-text-primary m-0"><%= pet.name || 'Unnamed Pet' %></h3>
      <% if (isLister && showEdit) { %>
        <button 
          class="py-1.5 px-3 bg-accent text-white border-0 rounded-md text-sm cursor-pointer whitespace-nowrap hover:bg-accent-hover"
          onclick="editPet('<%= pet.id %>');"
        >
          ‚úèÔ∏è Edit
        </button>
      <% } %>
    </div>
    
    <p class="m-0 text-text-secondary text-[0.9375rem]"><%= pet.breed || 'Mixed Breed' %></p>
    
    <%- include('pet-tile-meta', { pet, isLister, showBreedTag: false, showStatusTag: true }) %>
    
    <% if (pet.custom_availability_date) { %>
      <div class="flex flex-col gap-1">
        <span class="text-xs text-text-muted uppercase tracking-wide font-semibold">Available</span>
        <span class="text-sm text-text-primary capitalize"><%= formatDate(pet.custom_availability_date) %></span>
      </div>
    <% } %>
    
    <% if (pet.expiry_date) { %>
      <div class="flex flex-col gap-1">
        <span class="text-xs text-text-muted uppercase tracking-wide font-semibold">Expires</span>
        <span class="text-sm text-text-primary capitalize"><%= formatDate(pet.expiry_date) %></span>
      </div>
    <% } %>
    
    <% if (pet.description) { %>
      <div class="flex flex-col gap-2 pt-2 border-t border-border">
        <span class="text-xs text-text-muted uppercase tracking-wide font-semibold">Description</span>
        <p class="text-sm text-text-secondary leading-relaxed normal-case"><%= pet.description %></p>
      </div>
    <% } %>
  </div>
</div>
